<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Large countries &#8212; geefcc — Forest cover change from Google Earth Engine</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=d35aba6c" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=8fb1bb4b" />
    <script src="../../_static/documentation_options.js?v=fd825880"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="New Caledonia" href="../newcal/newcal.html" />
    <link rel="prev" title="Articles" href="../../articles.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo-geefcc.svg" alt="Logo" />
    
    <h1 class="logo logo-name">geefcc</h1>
    
  </a>
</p>



<p class="blurb">Forest cover change from Google Earth Engine</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=ghislainv&repo=geefcc&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/get_started.html">Get started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../articles.html">Articles</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../get_started/get_started.html">Get started</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Large countries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../newcal/newcal.html">New Caledonia</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices.html">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../../articles.html">Articles</a><ul>
      <li>Previous: <a href="../../articles.html" title="previous chapter">Articles</a></li>
      <li>Next: <a href="../newcal/newcal.html" title="next chapter">New Caledonia</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="large-countries">
<h1>Large countries<a class="headerlink" href="#large-countries" title="Link to this heading">¶</a></h1>
<section id="download-the-data-from-gee">
<h2>Download the data from GEE<a class="headerlink" href="#download-the-data-from-gee" title="Link to this heading">¶</a></h2>
<p>We can use <code class="docutils literal notranslate"><span class="pre">geefcc</span></code> to download forest cover change for large countries,
for example Perou (iso code “PER”). The country will be divided into
several tiles which are processed in parallel. If your computer has n
cores, n-1 cores will be used in parallel.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">ee</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">from</span> <span class="nn">geefcc</span> <span class="kn">import</span> <span class="n">get_fcc</span><span class="p">,</span> <span class="n">sum_raster_bands</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
</pre></div>
</div>
<p>We initialize Google Earth Engine.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize GEE</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s2">&quot;forestatrisk&quot;</span><span class="p">,</span>
              <span class="n">opt_url</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;https://earthengine-highvolume.&quot;</span>
                       <span class="s2">&quot;googleapis.com&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>We can compute the number of cores used for the computation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ncpu</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">ncpu</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span>
</pre></div>
</div>
<p>We download the forest cover change data from GEE for Peru for years 2000, 2010 and 2020, using a buffer of about 10 km around the border (0.089… decimal degrees) and a tile size of one degree.</p>
<p>A buffer can be useful if we want to avoid “edge effects”, while computing distance to forest edge for example. One degree tiles are used to download the data from GEE in parallel.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">get_fcc</span><span class="p">(</span>
    <span class="n">aoi</span><span class="o">=</span><span class="s2">&quot;PER&quot;</span><span class="p">,</span>
    <span class="n">buff</span><span class="o">=</span><span class="mf">0.08983152841195216</span><span class="p">,</span>
    <span class="n">years</span><span class="o">=</span><span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2020</span><span class="p">],</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;tmf&quot;</span><span class="p">,</span>
    <span class="n">tile_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;out_tmf/forest_tmf.tif&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</pre></div>
</div>
<p>We estimate the computation time to download 159 1-degree tiles using several cores.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Execution time:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;minutes&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Execution</span> <span class="n">time</span><span class="p">:</span> <span class="mf">30.76</span> <span class="n">minutes</span>
</pre></div>
</div>
</section>
<section id="transform-multiband-fcc-raster-in-one-band-raster">
<h2>Transform multiband fcc raster in one band raster<a class="headerlink" href="#transform-multiband-fcc-raster-in-one-band-raster" title="Link to this heading">¶</a></h2>
<p>We transform the data to have only one band describing the forest cover change with 0 for non-forest, 1 for deforestation on the period 2000–2009, 2 for deforestation on the period 2010–2019, and 3 for the remaining forest in 2020. To do so, we just sum the values of the raster bands.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sum_raster_bands</span><span class="p">(</span><span class="n">input_file</span><span class="o">=</span><span class="s2">&quot;out_tmf/forest_tmf.tif&quot;</span><span class="p">,</span>
                 <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;out_tmf/fcc_tmf.tif&quot;</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>We resample at a lower resolution for plotting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">infn</span> <span class="o">=</span> <span class="s2">&quot;out_tmf/fcc_tmf.tif&quot;</span>
<span class="n">outfn</span> <span class="o">=</span> <span class="s2">&quot;out_tmf/fcc_tmf_coarsen.tif&quot;</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">infn</span><span class="p">)</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">xres</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">scale</span>
<span class="n">yres</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">scale</span>
<span class="n">resample_alg</span> <span class="o">=</span> <span class="s2">&quot;near&quot;</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span><span class="n">outfn</span><span class="p">,</span> <span class="n">infn</span><span class="p">,</span> <span class="n">xRes</span><span class="o">=</span><span class="n">xres</span><span class="p">,</span> <span class="n">yRes</span><span class="o">=</span><span class="n">yres</span><span class="p">,</span> <span class="n">resampleAlg</span><span class="o">=</span><span class="n">resample_alg</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
<section id="plot-the-forest-cover-change-map">
<h2>Plot the forest cover change map<a class="headerlink" href="#plot-the-forest-cover-change-map" title="Link to this heading">¶</a></h2>
<p>We prepare the colors for the map.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Colors</span>
<span class="n">cols</span><span class="o">=</span><span class="p">[(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">227</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">255</span><span class="p">)]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>  <span class="c1"># transparent white for 0</span>
<span class="n">cmax</span> <span class="o">=</span> <span class="mf">255.0</span>  <span class="c1"># float for division</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">col_class</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">i</span> <span class="o">/</span> <span class="n">cmax</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">col</span><span class="p">])</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_class</span><span class="p">)</span>
<span class="n">color_map</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

<span class="c1"># Labels</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;non-forest in 2000&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s2">&quot;deforestation 2000-2009&quot;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">:</span><span class="s2">&quot;deforestation 2010-2019&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s2">&quot;forest in 2020&quot;</span><span class="p">}</span>
<span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
</pre></div>
</div>
<p>We load the data: country borders, buffer, and grid.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Borders</span>
<span class="n">borders_gpkg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;out_tmf&quot;</span><span class="p">,</span> <span class="s2">&quot;gadm41_PER_0.gpkg&quot;</span><span class="p">)</span>
<span class="n">borders</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">borders_gpkg</span><span class="p">)</span>

<span class="c1"># Buffer</span>
<span class="n">buffer_gpkg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;out_tmf&quot;</span><span class="p">,</span> <span class="s2">&quot;gadm41_PER_buffer.gpkg&quot;</span><span class="p">)</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">buffer_gpkg</span><span class="p">)</span>

<span class="c1"># Grid</span>
<span class="n">grid_gpkg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;out_tmf&quot;</span><span class="p">,</span> <span class="s2">&quot;min_grid.gpkg&quot;</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">grid_gpkg</span><span class="p">)</span>
</pre></div>
</div>
<p>We plot the forest cover change map.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;out_tmf/fcc_tmf_coarsen.tif&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">raster_image</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
    <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="n">raster_image</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xres</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">yres</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">+</span> <span class="n">xres</span> <span class="o">*</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">yres</span> <span class="o">*</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">raster_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
          <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">grid_image</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">borders_image</span> <span class="o">=</span> <span class="n">borders</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">buffer_image</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Forest cover change 2000-2010-2020, TMF&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;fcc.png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/fcc.png"><img alt="../../_images/fcc.png" class="align-center" src="../../_images/fcc.png" style="width: 700px;" />
</a>
<p>Lines in black represent country borders and the 10 km buffer. One degree tiles in grey cover the whole buffer and were used to download the data in parallel.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2024, Cirad.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/notebooks/large_countries/large_countries.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>